name: build

on:
  push:
    branches:
      - main
      - release/*
  pull_request:
    paths-ignore:
      - 'CHANGELOG.md'
jobs:
  benchmark:
    name: Performance regression check
    runs-on: ubuntu-latest

    steps:
        - name: Checkout
          uses: actions/checkout@v2.3.3
          with:
            submodules: recursive

        - name: Retrieve previous benchmarks
          uses: actions/cache@v1
          with:
            path: ./cache
            key: ${{ runner.os }}-benchmark

        - name: Run benchmarks
          uses: Happypig375/github-action-benchmark@v1.8.2
          with:
            tool: 'benchmarkdotnet'
            # Where the output from the benchmark tool is stored
            output-file-path: output.txt
            # Where the previous data file is stored
            external-data-json-path: ./cache/benchmark-data.json
            # Workflow will fail when an alert happens
            fail-on-alert: true
